# 灰度变换与空间滤波

## 3.3 直方图处理

### 3.3.1 直方图均衡化

$p_r(r)$ 与 $p_s(s)$ 是两幅不同图像中的灰度值的**概率密度函数**(PDF)，若已知 $p_r(r)$ 与 $T(r)$，且 $T(r)$ 在感兴趣域上连续可微，则变换后 $s$ 的概率密度函数为
$$
\tag{3.10} p_s(s) = p_r(r) |\frac{dr}{ds}|
$$

图像处理中一个特别重要的变换函数是
$$
\tag{3.11} s = T(r) = (L-1) \int_0^r p_r(w) dw
$$
右侧积分是随机变量 $r$ 的累计分布函数(CDF)

将 $(3.11)$ 代入 $(3.10)$ 得
$$
\tag{3.13} p_s(s) = \frac{1}{L-1}
$$
因此 $(3.11)$ 可用于直方图均衡化(自适应、自动对比度)

### 3.3.2 直方图匹配(规定化)

> 可用于生成具有规定直方图的图像

根据 $(3.11)$ 的离散形式
$$
\tag{3.21} G(z_q) = (L-1) \sum_{i=0}^q p_z(z_i) = s_k
$$
可以得到一个映射表，满足
$$
\tag{3.23} z_q = G^{-1}(s_k)
$$
其可用于直方图匹配

### 3.3.3 局部直方图均衡化

> 可用于局部增强

方式：每次选取某像素，计算其邻域的直方图均衡化函数，作为该像素的映射函数，重复这一过程直至所有像素完成计算

### 3.3.4 使用直方图统计量增强图像

> 可用于局部增强，效果往往优于局部直方图均衡化

方式：选取某像素的邻域作为局部，计算**局部平均灰度**与**局部对比度**，与全局值比较，若处在规定阈值内，则进行增强(例如，将灰度乘以某个常数 $C$)

## 3.4 空间滤波基础

### 3.4.1 线性空间滤波的原理

(离散区间上的)卷积
$$
\tag{3.31} g(x,y) = \sum_{s=-a}^a \sum_{s=-b}^b w(s,t) f(x-s,y-t)
$$

### 3.4.3 可分离滤波器核

如果 $G(x,y) = G_1(x) G_2(y)$，则它是可分离的，例如
$$
w = \begin{bmatrix}
    1 & 1 & 1 \\
    1 & 1 & 1 \\
\end{bmatrix} = \begin{bmatrix}
    1 \\ 1
\end{bmatrix} \begin{bmatrix}
    1 & 1 & 1
\end{bmatrix}
$$
利用卷积的结合律，**图像可以分别与每个可分离核进行运算，进而降低卷积运算的时间复杂度**

可分离的核的秩为 $1$

## 3.5 平滑(低通)空间滤波器

### 3.5.2 低通高斯滤波器核

高斯核：
$$
\tag{3.45} G(s,t) = Ke^\frac{s^2 + t^2}{2 \sigma^2}
$$
是**唯一可分离的圆对称核**

当距离大于 $3 \sigma$ 时 $G$ 值会小到可以忽略，因此使用边长大于 $6 \sigma + 1$ 的核缺乏意义

两个高斯函数的乘积和卷积也是高斯函数，因此可以将一个高斯核替换为多个高斯核进行卷积，从而提升运算效率

使用高斯核得到的模糊图像，相比盒式核，其边缘更**平滑**

## 3.5.3 统计排序(非线性)滤波器

最常用的是**中值滤波器**，非常适合用于**降低冲激噪声**

## 3.6 锐化(高通)空间滤波器核

* 拉普拉斯核：基于二阶导数，用于锐化
* 索贝尔核：基于梯度，常用于预处理、边缘检测、放大微小缺陷

## 3.7 低通、高通、带阻、带通滤波器

滤波器分类：
* 低通
* 高通
* 带阻
* 带通

所有滤波器都可以基于低通滤波器进行构建，且通常使用类似如下的**同心圆反射板**进行测试
$$
\tag{3.66} z(x,y) = \frac{1}{2} [1+\cos{(x^2+y^2)}]
$$
